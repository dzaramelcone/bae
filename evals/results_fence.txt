============================= test session starts ==============================
platform darwin -- Python 3.14.3, pytest-9.0.2, pluggy-1.6.0 -- /Users/dzaramelcone/lab/bae/.venv/bin/python
cachedir: .pytest_cache
rootdir: /Users/dzaramelcone/lab/bae
configfile: pyproject.toml
plugins: anyio-4.12.1, asyncio-1.3.0, logfire-4.22.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 135 items / 90 deselected / 45 selected

evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-0] PASSED [  2%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-1] PASSED [  4%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-2] PASSED [  6%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What's 2**100?-0] PASSED [  8%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What's 2**100?-1] PASSED [ 11%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What's 2**100?-2] PASSED [ 13%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Explain how Dep works with an -0] PASSED [ 15%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Explain how Dep works with an -1] PASSED [ 17%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Explain how Dep works with an -2] PASSED [ 20%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What variables do I have?-0] PASSED [ 22%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What variables do I have?-1] PASSED [ 24%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What variables do I have?-2] PASSED [ 26%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Show me how to define a Node, -0] PASSED [ 28%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Show me how to define a Node, -1] PASSED [ 31%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Show me how to define a Node, -2] PASSED [ 33%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-0] PASSED [ 35%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-1] FAILED [ 37%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-2] FAILED [ 40%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What's 2**100?-0] PASSED [ 42%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What's 2**100?-1] PASSED [ 44%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What's 2**100?-2] PASSED [ 46%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Explain how Dep works with an -0] PASSED [ 48%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Explain how Dep works with an -1] PASSED [ 51%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Explain how Dep works with an -2] PASSED [ 53%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What variables do I have?-0] PASSED [ 55%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What variables do I have?-1] PASSED [ 57%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What variables do I have?-2] PASSED [ 60%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Show me how to define a Node, -0] PASSED [ 62%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Show me how to define a Node, -1] PASSED [ 64%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Show me how to define a Node, -2] PASSED [ 66%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-0] PASSED [ 68%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-1] FAILED [ 71%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-2] PASSED [ 73%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What's 2**100?-0] PASSED [ 75%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What's 2**100?-1] PASSED [ 77%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What's 2**100?-2] PASSED [ 80%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Explain how Dep works with an -0] PASSED [ 82%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Explain how Dep works with an -1] PASSED [ 84%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Explain how Dep works with an -2] PASSED [ 86%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What variables do I have?-0] PASSED [ 88%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What variables do I have?-1] PASSED [ 91%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What variables do I have?-2] PASSED [ 93%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Show me how to define a Node, -0] PASSED [ 95%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Show me how to define a Node, -1] PASSED [ 97%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Show me how to define a Node, -2] PASSED [100%]

=================================== FAILURES ===================================
_ test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-1] _
evals/test_convention.py:45: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:277: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   A Graph in bae is a directed agent graph that orchestrates execution flow through a collection of Node classes. It uses type hints to automatically route from one node to the next.
E   
E   Key concepts:
E   
E   - **Type-based routing**: Each Node declares what type it produces. The Graph uses that type to determine which Node runs next.
E   - **Terminal nodes**: Execution stops when a Node produces a type that no other Node accepts, or when a Node explicitly marks itself as terminal.
E   - **Dependency injection**: Fields annotated with `Dep(fn)` are automatically resolved before the Node executes.
E   - **State accumulation**: The Graph maintains a context object that accumulates outputs from all executed nodes.
E   
E   Here's the basic pattern:
E   
E   ```python
E   # Illustrative example
E   class StartNode(Node):
E       def run(self) -> str:
E           return "hello"
E   
E   class NextNode(Node):
E       message: str  # Receives output from StartNode
E       
E       def run(self) -> int:
E           return len(self.message)
E   
E   # Graph routes: StartNode → NextNode (because NextNode accepts str)
E   graph = Graph(nodes=[StartNode, NextNode])
E   result = graph.run(StartNode)
E   ```
E   
E   The Graph handles the entire execution flow automatically based on these type annotations.
_ test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-2] _
evals/test_convention.py:45: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:277: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   A Graph in bae is a directed agent graph built from Node type hints. It routes execution through nodes based on type annotations, with each node producing a typed output that determines the next node.
E   
E   Here's how it works:
E   
E   ```python
E   # Illustrative example of a Graph
E   from bae import Node, Graph
E   
E   class Start(Node):
E       def run(self) -> str:
E           return "hello"
E   
E   class ProcessText(Node):
E       def run(self, text: str) -> int:
E           return len(text)
E   
E   class End(Node):
E       def run(self, length: int) -> None:
E           print(f"Length: {length}")
E   
E   # The Graph infers edges from type annotations
E   graph = Graph(nodes=[Start, ProcessText, End])
E   # Start() -> str matches ProcessText(text: str)
E   # ProcessText() -> int matches End(length: int)
E   ```
E   
E   The graph automatically connects nodes where one's output type matches another's input parameter type, creating an execution flow without explicit edge definitions.
_ test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-1] _
evals/test_convention.py:45: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:277: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   A **Graph** in bae is a directed agent graph built from Node type hints. It's the core execution engine that:
E   
E   1. **Routes execution through nodes** based on their type annotations
E   2. **Chains nodes together** where each node's output type determines which node runs next
E   3. **Resolves dependencies** automatically using field annotations like `Dep()`
E   4. **Executes in sequence** until a terminal node is reached or the graph completes
E   
E   Think of it as a state machine where nodes are states and their return types are transitions. The Graph inspects your Node definitions, understands their input/output types, and orchestrates the flow automatically.
E   
E   Example structure:
E   ```python
E   # Illustrative
E   class StartNode(Node):
E       def execute(self) -> str:
E           return "hello"
E   
E   class ProcessNode(Node):
E       input: str  # expects StartNode's output
E       def execute(self) -> int:
E           return len(self.input)
E   
E   # The Graph automatically connects StartNode → ProcessNode
E   graph = Graph([StartNode, ProcessNode])
E   result = graph.run()  # executes in order
E   ```
E   
E   The Graph handles all the wiring—you just define nodes with clear input/output types and it figures out the dependencies.
=========================== short test summary info ============================
FAILED evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-1]
FAILED evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-2]
FAILED evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-1]
=========== 3 failed, 42 passed, 90 deselected in 212.07s (0:03:32) ============
