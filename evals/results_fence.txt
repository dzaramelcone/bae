============================= test session starts ==============================
platform darwin -- Python 3.13.0, pytest-9.0.2, pluggy-1.6.0 -- /Library/Frameworks/Python.framework/Versions/3.13/bin/python3
cachedir: .pytest_cache
rootdir: /Users/dzaramelcone/lab/bae
configfile: pyproject.toml
plugins: anyio-4.11.0, xdist-3.8.0, langsmith-0.6.7, asyncio-1.3.0, logfire-4.22.0, typeguard-4.4.4
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 270 items / 225 deselected / 45 selected

evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-0] FAILED [  2%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-1] FAILED [  4%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-2] FAILED [  6%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What's 2**100?-0] PASSED [  8%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What's 2**100?-1] PASSED [ 11%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What's 2**100?-2] PASSED [ 13%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Explain how Dep works with an -0] PASSED [ 15%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Explain how Dep works with an -1] PASSED [ 17%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Explain how Dep works with an -2] PASSED [ 20%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What variables do I have?-0] PASSED [ 22%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What variables do I have?-1] PASSED [ 24%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What variables do I have?-2] PASSED [ 26%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Show me how to define a Node, -0] PASSED [ 28%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Show me how to define a Node, -1] PASSED [ 31%]
evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-Show me how to define a Node, -2] PASSED [ 33%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-0] FAILED [ 35%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-1] FAILED [ 37%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-2] FAILED [ 40%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What's 2**100?-0] PASSED [ 42%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What's 2**100?-1] PASSED [ 44%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What's 2**100?-2] PASSED [ 46%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Explain how Dep works with an -0] PASSED [ 48%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Explain how Dep works with an -1] PASSED [ 51%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Explain how Dep works with an -2] PASSED [ 53%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What variables do I have?-0] PASSED [ 55%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What variables do I have?-1] PASSED [ 57%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What variables do I have?-2] PASSED [ 60%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Show me how to define a Node, -0] PASSED [ 62%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Show me how to define a Node, -1] PASSED [ 64%]
evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-Show me how to define a Node, -2] PASSED [ 66%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-0] PASSED [ 68%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-1] PASSED [ 71%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-2] FAILED [ 73%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What's 2**100?-0] PASSED [ 75%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What's 2**100?-1] PASSED [ 77%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What's 2**100?-2] PASSED [ 80%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Explain how Dep works with an -0] PASSED [ 82%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Explain how Dep works with an -1] PASSED [ 84%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Explain how Dep works with an -2] PASSED [ 86%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What variables do I have?-0] PASSED [ 88%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What variables do I have?-1] PASSED [ 91%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What variables do I have?-2] PASSED [ 93%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Show me how to define a Node, -0] PASSED [ 95%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Show me how to define a Node, -1] PASSED [ 97%]
evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Show me how to define a Node, -2] FAILED [100%]

=================================== FAILURES ===================================
_ test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-0] _
evals/test_convention.py:43: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:265: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   ```python:exec
E   # Let me look at the bae module to understand what Graph is
E   import bae
E   help(bae.Graph)
E   ```
_ test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-1] _
evals/test_convention.py:43: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:265: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   ```python:exec
E   # Let me look at the bae module to understand what Graph is
E   import bae
E   help(bae.Graph)
E   ```
_ test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-2] _
evals/test_convention.py:43: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:265: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   ```python:exec
E   # Let me look up the Graph class in the bae package
E   import bae
E   help(bae.Graph)
E   ```
_ test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-0] _
evals/test_convention.py:43: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:265: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   In `bae` (Build Anything Engine), a **Graph** is the core abstraction that represents a computation graph or workflow. It's a collection of interconnected nodes where:
E   
E   1. **Nodes** are the building blocks - each node represents a unit of computation or data
E   2. **Edges** connect nodes through dependencies - when one node depends on another node's output
E   3. **Execution** happens automatically based on the dependency graph - nodes are evaluated in the correct order
E   
E   Here's a simple example:
E   
E   ```python
E   from bae import Graph, Node
E   
E   class AddNode(Node):
E       a: int
E       b: int
E       
E       def run(self):
E           return self.a + self.b
E   
E   # Create a graph
E   g = Graph()
E   
E   # Add nodes to the graph
E   result = g.add(AddNode(a=5, b=3))
E   
E   # Execute the graph
E   output = g.run()
E   ```
E   
E   The Graph handles:
E   - **Dependency resolution** - figures out what order to run nodes
E   - **Caching** - avoids re-computing unchanged nodes
E   - **Data flow** - passes outputs from one node as inputs to another
E   - **Parallel execution** - can run independent nodes concurrently
E   
E   Graphs can be composed and nested, making them powerful for building complex workflows from simple components.
_ test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-1] _
evals/test_convention.py:43: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:265: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   In bae, a **Graph** is a container that holds and manages a collection of nodes and their dependencies. It's the core orchestration structure that:
E   
E   1. **Stores nodes**: You add nodes to a graph, and the graph tracks their relationships
E   2. **Resolves dependencies**: When you run a node, the graph automatically figures out which other nodes need to run first based on their `Dep()` annotations
E   3. **Executes computation**: The graph runs nodes in the correct order, passing data between them
E   
E   Here's a basic example:
E   
E   ```python
E   from bae import Graph, Node, Dep
E   from typing import Annotated
E   
E   # Define some nodes
E   class Add(Node):
E       a: int
E       b: int
E       
E       def run(self):
E           return self.a + self.b
E   
E   class Multiply(Node):
E       x: int
E       y: Annotated[int, Dep(Add)]  # depends on Add's result
E       
E       def run(self):
E           return self.x * self.y
E   
E   # Create and use a graph
E   graph = Graph()
E   result = graph.run(Multiply(x=3, Add(a=5, b=2)))
E   # Add runs first (5+2=7), then Multiply (3*7=21)
E   ```
E   
E   The Graph handles all the dependency resolution and execution ordering automatically, so you just declare what depends on what, and bae figures out the rest.
_ test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-2] _
evals/test_convention.py:43: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:265: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   In bae, a **Graph** is a declarative way to define and compose AI agents with dependencies between nodes.
E   
E   ```python
E   from bae import Graph, Node
E   
E   # Define a graph with nodes that depend on each other
E   graph = Graph(
E       nodes={
E           "user_input": Node(lambda: "hello"),
E           "processed": Node(lambda user_input: user_input.upper()),
E           "final": Node(lambda processed: f"Result: {processed}")
E       }
E   )
E   
E   # Run the graph
E   result = graph.run()
E   ```
E   
E   Key features:
E   
E   - **Dependency injection**: Nodes automatically receive values from other nodes based on parameter names
E   - **Execution order**: The graph figures out the right order to run nodes based on their dependencies
E   - **Type safety**: Uses Python type hints and the `Dep` annotation to declare dependencies
E   - **Reusable**: Define once, run multiple times with different inputs
E   
E   Think of it as a computational graph where each node is a function, and edges are data dependencies between them.
_ test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-2] _
evals/test_convention.py:43: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:265: in validate_response
    assert len(all_python) == 0, (
           ^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected no code blocks, got 1.
E   Response:
E   In **bae** (Anthropic's Python framework), a **Graph** is a data structure that represents a directed acyclic graph (DAG) of computation nodes. It's used to define workflows or pipelines where:
E   
E   - **Nodes** are individual computational units (functions or classes)
E   - **Edges** represent data flow between nodes
E   - **Dependencies** are automatically resolved based on type annotations
E   
E   Key features:
E   
E   1. **Declarative**: You define what depends on what using type hints
E   2. **Lazy evaluation**: The graph is built but not executed until you run it
E   3. **Composable**: Graphs can be nested and combined
E   4. **Type-safe**: Uses Python's type system for dependency resolution
E   
E   **Basic example structure:**
E   ```python
E   class MyGraph(Graph):
E       step1: OutputType = Node(compute_step1)
E       step2: OutputType = Node(compute_step2, input_param=step1)  # depends on step1
E       result: FinalType = Node(combine, a=step1, b=step2)
E   ```
E   
E   When you execute the graph, it automatically:
E   - Determines execution order based on dependencies
E   - Passes outputs from one node to dependent nodes
E   - Returns the final result
E   
E   Graphs are useful for building complex data pipelines, machine learning workflows, or any multi-step process with clear dependencies.
E   
E   Do you have a specific question about how Graphs work or how to use them?
_ test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Show me how to define a Node, -2] _
evals/test_convention.py:43: in test_convention_compliance
    validate_response(response, convention, expected)
evals/prompts.py:307: in validate_response
    assert len(all_python) > len(exec_blocks), (
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected illustrative blocks beyond exec blocks. Total: 1, exec: 1.
E   Response:
E   I'll show you how to define a Node and create one for you.
E   
E   ```python:exec
E   from cortex import Node
E   
E   # Define a simple Node
E   class Greeter(Node):
E       """A simple node that greets someone"""
E       name: str
E       
E       def forward(self):
E           return f"Hello, {self.name}!"
E   
E   # Create an instance
E   greeter = Greeter(name="Claude")
E   result = greeter.forward()
E   print(result)
E   ```
E   
E   Here's what happened:
E   
E   1. **Define a Node**: Inherit from `Node` and add fields (like `name`). The `forward()` method is where the node does its computation.
E   
E   2. **Create an instance**: Pass the required fields when initializing the node (e.g., `name="Claude"`).
E   
E   3. **Use it**: Call `forward()` to execute the node's logic.
E   
E   You now have a `Greeter` node that can greet anyone! You can create more instances with different names if you'd like.
=========================== short test summary info ============================
FAILED evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-0]
FAILED evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-1]
FAILED evals/test_convention.py::test_convention_compliance[claude-opus-4-6-fence_annotation-What is a Graph in bae?-2]
FAILED evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-0]
FAILED evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-1]
FAILED evals/test_convention.py::test_convention_compliance[claude-sonnet-4-5-20250929-fence_annotation-What is a Graph in bae?-2]
FAILED evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-What is a Graph in bae?-2]
FAILED evals/test_convention.py::test_convention_compliance[claude-haiku-4-5-20251001-fence_annotation-Show me how to define a Node, -2]
=========== 8 failed, 37 passed, 225 deselected in 225.15s (0:03:45) ===========
