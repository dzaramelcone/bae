---
phase: 32.1-resourcespace-package-structure
plan: 01
subsystem: api
tags: [python-packaging, refactor, backward-compat, resourcespace]

# Dependency graph
requires:
  - phase: 32-source-resourcespace
    provides: SourceResourcespace, home tools, resource protocol
provides:
  - bae/repl/spaces/ package structure with source/ and home/ sub-packages
  - Backward-compatible re-export shims at old import paths
  - Protocol types importable from bae.repl.spaces
affects: [32.1-02, 33-session-resourcespace, 34-graph-resourcespace]

# Tech tracking
tech-stack:
  added: []
  patterns: [spaces-package-layout, re-export-shims]

key-files:
  created:
    - bae/repl/spaces/__init__.py
    - bae/repl/spaces/source/__init__.py
    - bae/repl/spaces/source/service.py
    - bae/repl/spaces/source/models.py
    - bae/repl/spaces/source/schemas.py
    - bae/repl/spaces/source/view.py
    - bae/repl/spaces/home/__init__.py
    - bae/repl/spaces/home/service.py
    - bae/repl/spaces/home/view.py
  modified:
    - bae/repl/source.py
    - bae/repl/ai.py
    - bae/repl/shell.py
    - bae/repl/tools.py
    - tests/test_source.py

key-decisions:
  - "MetaSubresource._module_path updated to bae.repl.spaces.source.service (canonical location after move)"
  - "One test assertion updated to match new module path (inherent to move, not a logic change)"

patterns-established:
  - "spaces/ package layout: spaces/{name}/{__init__.py, service.py, models.py, schemas.py, view.py}"
  - "Old modules become thin re-export shims for backward compat"

# Metrics
duration: 6min
completed: 2026-02-16
---

# Phase 32.1 Plan 01: Resourcespace Package Structure Summary

**Source and home resourcespace code relocated to bae/repl/spaces/ sub-packages with backward-compatible re-export shims**

## Performance

- **Duration:** 6 min
- **Started:** 2026-02-16T18:15:48Z
- **Completed:** 2026-02-16T18:21:23Z
- **Tasks:** 2
- **Files modified:** 14

## Accomplishments
- Created bae/repl/spaces/ package with source/ and home/ sub-packages
- Moved all source resourcespace code (models, service, subresources) to spaces/source/
- Moved all home filesystem tools (_exec_read, _exec_glob, etc.) to spaces/home/
- Old import paths (bae.repl.source, bae.repl.ai) still work via re-export shims
- Production code (shell.py, tools.py) updated to use new import paths
- All 787 tests pass (5 skipped)

## Task Commits

Each task was committed atomically:

1. **Task 1: Create spaces/ package and move source resourcespace code** - `4ebed1e` (feat)
2. **Task 2: Create home package and set up backward-compatible re-exports** - `9a87d37` (feat)

## Files Created/Modified
- `bae/repl/spaces/__init__.py` - Protocol re-exports from resource.py
- `bae/repl/spaces/source/__init__.py` - Public API re-exports for source sub-package
- `bae/repl/spaces/source/service.py` - SourceResourcespace and all subresource classes
- `bae/repl/spaces/source/models.py` - Domain helpers (path resolution, AST ops, hot-reload)
- `bae/repl/spaces/source/schemas.py` - Placeholder for future IO schemas
- `bae/repl/spaces/source/view.py` - Placeholder for future view helpers
- `bae/repl/spaces/home/__init__.py` - Re-exports for home filesystem tools
- `bae/repl/spaces/home/service.py` - Filesystem tools (_exec_read, _exec_write, etc.)
- `bae/repl/spaces/home/view.py` - Placeholder for future view helpers
- `bae/repl/source.py` - Thin re-export shim (backward compat)
- `bae/repl/ai.py` - Imports home tools from new location, old definitions removed
- `bae/repl/shell.py` - Imports from spaces/source and spaces/home
- `bae/repl/tools.py` - Imports from spaces/home

## Decisions Made
- MetaSubresource._module_path updated from `bae.repl.source` to `bae.repl.spaces.source.service` because _read_symbol needs AST access to actual class definitions, not re-export shims
- One test assertion updated to match new module path (test_read_shows_summary checked the literal string "bae.repl.source" which changed with the move)

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] MetaSubresource._module_path pointed to re-export shim**
- **Found during:** Task 2 (backward-compat setup)
- **Issue:** MetaSubresource._module_path was "bae.repl.source" but source.py is now a re-export shim with no class definitions. _read_symbol parses AST, so it couldn't find symbols.
- **Fix:** Updated _module_path to "bae.repl.spaces.source.service" (canonical location) and updated enter() description string to match.
- **Files modified:** bae/repl/spaces/source/service.py, tests/test_source.py
- **Verification:** All MetaSubresource tests pass, full suite 787 passed.
- **Committed in:** 9a87d37 (Task 2 commit)

---

**Total deviations:** 1 auto-fixed (1 bug)
**Impact on plan:** Essential fix for correctness. The plan stated "zero test modifications" but one assertion was inherently coupled to the file path that changed. No scope creep.

## Issues Encountered
None beyond the MetaSubresource deviation documented above.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Package structure is in place for Plan 02 (validation/cleanup if applicable)
- Future resourcespaces (session, graph) can follow the established spaces/{name}/ pattern
- All imports work from both old and new paths

---
*Phase: 32.1-resourcespace-package-structure*
*Completed: 2026-02-16*

## Self-Check: PASSED

All 9 created files verified on disk. Both task commits (4ebed1e, 9a87d37) verified in git log.
