---
phase: 10-hint-annotation
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - bae/graph.py
  - bae/lm.py
  - tests/test_fill_protocol.py
autonomous: true

must_haves:
  truths:
    - "_build_instruction() returns class name only — __doc__ is NOT read"
    - "_node_to_prompt() on both backends does NOT read __doc__"
    - "v1 make() on both backends does NOT read target.__doc__"
    - "v1 decide() on both backends does NOT read t.__doc__"
    - "v1 choose_type() on both backends does NOT read t.__doc__"
    - "Docstrings on Node subclasses are NOT automatically included in LLM prompts"
  artifacts:
    - path: "bae/graph.py"
      provides: "_build_instruction returns class name only"
      contains: "return target_type.__name__"
    - path: "bae/lm.py"
      provides: "_node_to_prompt without docstring reading"
    - path: "tests/test_fill_protocol.py"
      provides: "Updated tests asserting instruction is class name only"
  key_links:
    - from: "bae/graph.py"
      to: "bae/lm.py"
      via: "_build_instruction output flows into fill() instruction param"
      pattern: "instruction = _build_instruction"
---

<objective>
Remove all __doc__ (docstring) reading from LLM-facing code paths so class name alone is the instruction.

Purpose: Docstrings become inert — they exist for developer documentation only, not LLM prompting. This prevents LLMs from compulsively generating/augmenting docstrings on node classes. Explicit per-field context via Field(description=...) (Plan 02) replaces implicit docstring extraction.

Output: Updated bae/graph.py, bae/lm.py, tests/test_fill_protocol.py. All __doc__ references removed from prompt-building code.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@bae/graph.py
@bae/lm.py
@tests/test_fill_protocol.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: TDD - _build_instruction returns class name only</name>
  <files>bae/graph.py, tests/test_fill_protocol.py</files>
  <action>
RED phase: Update the existing test `test_instruction_is_class_name_plus_docstring` in tests/test_fill_protocol.py (class TestGraphFillIntegration, around line 238).

Current test asserts EndNode's instruction includes "Final recommendation." (the docstring). Change this to assert the instruction is ONLY "EndNode" — no docstring appended. Rename the test to `test_instruction_is_class_name_only`.

Specifically:
- Line 257: change `assert "Final recommendation." in lm.fill_calls[1]["instruction"]` to `assert lm.fill_calls[1]["instruction"] == "EndNode"`
- Keep the line 253 assertion: `assert lm.fill_calls[0]["instruction"] == "MiddleNode"` (already correct)

Also add a direct unit test for _build_instruction:
```python
class TestBuildInstruction:
    def test_returns_class_name_only(self):
        """_build_instruction returns class name, ignoring __doc__."""
        assert _build_instruction(EndNode) == "EndNode"

    def test_returns_class_name_when_no_docstring(self):
        assert _build_instruction(MiddleNode) == "MiddleNode"
```

Run tests — the integration test MUST fail (current _build_instruction appends docstring).
Commit: `test(10-01): update instruction tests — expect class name only, no docstring`

GREEN phase: Update `_build_instruction` in bae/graph.py (line 50-55).

Replace:
```python
def _build_instruction(target_type: type) -> str:
    """Build instruction string from class name + optional docstring."""
    instruction = target_type.__name__
    if target_type.__doc__:
        instruction += f": {target_type.__doc__.strip()}"
    return instruction
```

With:
```python
def _build_instruction(target_type: type) -> str:
    """Build instruction string from class name."""
    return target_type.__name__
```

Update the docstring on `_build_fill_prompt` (line 122) — change "Instruction (class name + optional docstring)" to "Instruction (class name)".

Run tests — they MUST pass.
Commit: `feat(10-01): _build_instruction returns class name only — docstrings inert`
  </action>
  <verify>`cd /Users/dzaramelcone/lab/bae && uv run pytest tests/test_fill_protocol.py -x -q` — all tests pass, instruction is class name only</verify>
  <done>_build_instruction returns only target_type.__name__. Docstrings are not read. Test confirms instruction == "EndNode" not "EndNode: Final recommendation."</done>
</task>

<task type="auto">
  <name>Task 2: Remove __doc__ from _node_to_prompt, make, decide, choose_type on both backends</name>
  <files>bae/lm.py</files>
  <action>
Remove all `__doc__` references from LLM-facing methods in bae/lm.py. There are 8 locations total.

PydanticAIBackend:
1. `_node_to_prompt` (line 262-263): Remove the `if node.__class__.__doc__:` block. Method becomes just:
   ```python
   def _node_to_prompt(self, node: Node) -> str:
       """Convert node state to JSON prompt string."""
       import json
       data = {node.__class__.__name__: node.model_dump(mode="json")}
       return json.dumps(data, indent=2)
   ```

2. `make` (line 274-275): Remove `if target.__doc__:` and the line `full_prompt += f"\n{target.__name__}: {target.__doc__}"`.

3. `decide` (line 302-303): Remove the loop body `if t.__doc__: full_prompt += f"\n- {t.__name__}: {t.__doc__}"`.

4. `choose_type` (line 331): Remove `if t.__doc__:` and `prompt += f"\n- {t.__name__}: {t.__doc__}"`.

ClaudeCLIBackend:
5. `_node_to_prompt` (line 385-386): Same change as PydanticAIBackend._node_to_prompt — remove the `if node.__class__.__doc__:` block.

6. `make` (line 395): Remove `if target.__doc__:` and the line `full_prompt += f"\n{target.__name__}: {target.__doc__}"`.

7. `decide` (line 467): Remove the loop `for t in successors: if t.__doc__: choice_prompt += ...`.

8. `choose_type` (line 504): Remove `if t.__doc__:` and `prompt += f"\n- {t.__name__}: {t.__doc__}"`.

After all removals, grep the file to confirm zero `__doc__` references remain:
```bash
grep -n '__doc__' bae/lm.py
```
Should return nothing.

Run full test suite to confirm no regressions.
Commit: `feat(10-01): remove __doc__ from all LLM prompt builders — docstrings fully inert`
  </action>
  <verify>`cd /Users/dzaramelcone/lab/bae && uv run pytest tests/ -x -q` — all 322 tests pass. `grep '__doc__' bae/lm.py bae/graph.py` returns nothing.</verify>
  <done>Zero __doc__ references remain in bae/graph.py or bae/lm.py. Docstrings on Node subclasses are never included in any LLM prompt.</done>
</task>

</tasks>

<verification>
- `uv run pytest tests/ -x -q` — all tests pass
- `grep -rn '__doc__' bae/graph.py bae/lm.py` — returns nothing
- _build_instruction(SomeClassWithDocstring) returns only class name
- No existing tests break from docstring removal (docstrings were optional context, not required by tests)
</verification>

<success_criteria>
- _build_instruction returns class name only
- _node_to_prompt on both backends omits docstring
- v1 make/decide and v2 choose_type on both backends omit docstrings
- All 322+ tests pass
- Zero __doc__ references in bae/graph.py or bae/lm.py
</success_criteria>

<output>
After completion, create `.planning/phases/10-hint-annotation/10-01-SUMMARY.md`
</output>
