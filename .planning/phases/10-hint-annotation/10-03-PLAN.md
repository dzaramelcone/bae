---
phase: 10-hint-annotation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - bae/compiler.py
  - bae/dspy_backend.py
  - tests/test_signature_v2.py
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "node_to_signature() returns class name only as instruction — __doc__ is NOT read"
    - "DSPyBackend.choose_type() does NOT read __doc__ on candidate types"
    - "grep -rn '__doc__' bae/compiler.py bae/dspy_backend.py returns zero matches"
  artifacts:
    - path: "bae/compiler.py"
      provides: "node_to_signature with docstring removal"
      contains: "instruction = node_cls.__name__"
    - path: "bae/dspy_backend.py"
      provides: "choose_type without docstring reading"
    - path: "tests/test_signature_v2.py"
      provides: "Updated instruction test expecting class name only"
  key_links:
    - from: "bae/compiler.py"
      to: "bae/dspy_backend.py"
      via: "node_to_signature import"
      pattern: "from bae.compiler import node_to_signature"
---

<objective>
Remove all remaining __doc__ references from DSPyBackend code paths (compiler.py and dspy_backend.py).

Purpose: Plans 10-01 and 10-02 cleaned PydanticAIBackend and ClaudeCLIBackend but missed DSPyBackend (the DEFAULT backend). The phase goal "make docstrings inert" is not met until ALL backends stop reading __doc__. This closes 3 verification gaps.

Output: Zero __doc__ references in bae/compiler.py and bae/dspy_backend.py. All tests pass.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-hint-annotation/10-01-SUMMARY.md
@.planning/phases/10-hint-annotation/10-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: TDD — node_to_signature returns class name only (compiler.py)</name>
  <files>bae/compiler.py, tests/test_signature_v2.py</files>
  <action>
RED: In tests/test_signature_v2.py, find the TestInstructionFromClassName class (around line 117). Update test_docstring_appended_to_instruction (line 129) to assert that a node WITH a docstring still produces instruction == class name only:

```python
def test_docstring_ignored_in_instruction(self):
    from bae.compiler import node_to_signature

    class AnalyzeUserIntent(Node):
        """Determine what the user wants from their query."""
        query: str

    sig = node_to_signature(AnalyzeUserIntent)
    # Phase 10: docstrings are inert — instruction is class name only
    assert sig.instructions == "AnalyzeUserIntent"
```

Also update the class docstring from "Class name (+ optional docstring) is the Signature instruction." to "Class name is the Signature instruction — docstrings are inert."

Run tests — this test MUST fail (currently compiler appends docstring).

GREEN: In bae/compiler.py:
1. Line 103: Change comment from "Instruction is built from class name + optional docstring." to "Instruction is built from class name only — docstrings are inert (Phase 10)."
2. Lines 129-132: Replace the 3-line block:
   ```python
   # Build instruction from class name + optional docstring
   instruction = node_cls.__name__
   if node_cls.__doc__ is not None:
       instruction += f": {node_cls.__doc__.strip()}"
   ```
   With:
   ```python
   # Build instruction from class name only — docstrings are inert (Phase 10)
   instruction = node_cls.__name__
   ```
3. Line 357 (fill method docstring): If instruction param is described as "Class name + optional docstring for the LLM", change to "Class name for the LLM."

Run tests — all must pass.
  </action>
  <verify>
1. `cd /Users/dzaramelcone/lab/bae && python -m pytest tests/test_signature_v2.py::TestInstructionFromClassName -v` — all 3 tests pass
2. `cd /Users/dzaramelcone/lab/bae && python -m pytest tests/test_compiler.py -v` — all pass
3. `grep -n '__doc__' bae/compiler.py` — zero matches
  </verify>
  <done>node_to_signature returns only class name as instruction. Docstrings on node classes are NOT appended. Test updated and passing.</done>
</task>

<task type="auto">
  <name>Task 2: Remove __doc__ from DSPyBackend.choose_type</name>
  <files>bae/dspy_backend.py</files>
  <action>
In bae/dspy_backend.py, find the choose_type method (starts around line 284). Locate the docstring loop at lines 321-324:

```python
# Add type docstrings to context
for t in types:
    if t.__doc__:
        context_str += f"\n- {t.__name__}: {t.__doc__}"
```

Delete these 4 lines entirely. The type names are already available to the LLM via the choice field desc (which lists all type names) and the context_str JSON. Docstrings should NOT be included — they are developer docs, not LLM context. If the user wants type descriptions in prompts, they should use Field(description=...) on the type's fields.

Run the full test suite to verify no regressions.
  </action>
  <verify>
1. `grep -n '__doc__' bae/dspy_backend.py` — zero matches
2. `cd /Users/dzaramelcone/lab/bae && python -m pytest tests/ -v` — all tests pass (323+ passed)
3. `grep -rn '__doc__' bae/compiler.py bae/dspy_backend.py bae/graph.py bae/lm.py` — zero matches across all LLM-facing files
  </verify>
  <done>All __doc__ references removed from DSPyBackend. grep confirms zero __doc__ references in bae/compiler.py, bae/dspy_backend.py, bae/graph.py, and bae/lm.py. Full test suite passes. Phase 10 goal "make docstrings inert" is fully achieved across ALL backends.</done>
</task>

</tasks>

<verification>
1. `grep -rn '__doc__' bae/compiler.py bae/dspy_backend.py bae/graph.py bae/lm.py` returns zero matches
2. `python -m pytest tests/ -v` — all tests pass, zero regressions
3. `python -c "from bae.compiler import node_to_signature; from bae.node import Node; class N(Node):\n  '''A docstring'''\n  x: str\nprint(node_to_signature(N).instructions)"` prints "N" (not "N: A docstring")
</verification>

<success_criteria>
- Zero __doc__ references in all 4 LLM-facing source files (compiler.py, dspy_backend.py, graph.py, lm.py)
- test_docstring_appended_to_instruction renamed and updated to assert class-name-only behavior
- Full test suite passes with zero regressions
- All 3 verification gaps from 10-VERIFICATION.md closed
</success_criteria>

<output>
After completion, create `.planning/phases/10-hint-annotation/10-03-SUMMARY.md`
</output>
