---
phase: 32.1.1-subresource-packages-shim-removal
plan: 02
subsystem: api
tags: [refactor, subresource, packages, view-service-split]

requires:
  - phase: 32.1.1-01
    provides: Protocol types in spaces/view.py, canonical imports
provides:
  - Four subresource packages (deps, config, tests, meta) under source/ with view/service split
  - Slimmed source/service.py containing only SourceResourcespace
  - Selective __all__ in source/__init__.py
affects: [32.1.1-03, 32.1.1-04]

tech-stack:
  added: []
  patterns: [subresource packages follow view.py (protocol wrapper) + service.py (implementation) convention]

key-files:
  created:
    - bae/repl/spaces/source/deps/__init__.py
    - bae/repl/spaces/source/deps/view.py
    - bae/repl/spaces/source/deps/service.py
    - bae/repl/spaces/source/config/__init__.py
    - bae/repl/spaces/source/config/view.py
    - bae/repl/spaces/source/config/service.py
    - bae/repl/spaces/source/tests/__init__.py
    - bae/repl/spaces/source/tests/view.py
    - bae/repl/spaces/source/tests/service.py
    - bae/repl/spaces/source/meta/__init__.py
    - bae/repl/spaces/source/meta/view.py
    - bae/repl/spaces/source/meta/service.py
  modified:
    - bae/repl/spaces/source/service.py
    - bae/repl/spaces/source/__init__.py
    - tests/test_source.py

key-decisions:
  - "Meta _module_path stays as bae.repl.spaces.source.service for nav/read/edit (needs AST-parseable definitions), enter() references broader package for orientation"
  - "Subresource view classes delegate all methods to module-level service functions, passing project_root as first arg"

patterns-established:
  - "Subresource package layout: {name}/__init__.py (re-export), view.py (protocol class), service.py (implementation functions)"
  - "View delegates to service via: return service.func(self._root, ...)"

duration: 5min
completed: 2026-02-16
---

# Phase 32.1.1 Plan 02: Subresource Package Extraction Summary

**Four subresource classes extracted into own packages with view/service split, source/service.py slimmed to SourceResourcespace only**

## Performance

- **Duration:** 5 min
- **Started:** 2026-02-16T19:30:08Z
- **Completed:** 2026-02-16T19:35:11Z
- **Tasks:** 2
- **Files modified:** 15

## Accomplishments
- DepsSubresource, ConfigSubresource, TestsSubresource, MetaSubresource each extracted into own packages under source/
- Each package follows view.py (protocol wrapper) + service.py (implementation functions) convention
- source/service.py reduced from ~568 lines to ~290 lines, containing only SourceResourcespace
- source/__init__.py defines __all__ with selective public API exports
- All 787 tests pass unchanged behavior

## Task Commits

Each task was committed atomically:

1. **Task 1: Extract deps and config subresources into packages** - `95b7123` (feat)
2. **Task 2: Extract tests and meta subresources, slim source/service.py** - `c97148e` (feat)

## Files Created/Modified
- `bae/repl/spaces/source/deps/{__init__,view,service}.py` - Deps subresource package
- `bae/repl/spaces/source/config/{__init__,view,service}.py` - Config subresource package
- `bae/repl/spaces/source/tests/{__init__,view,service}.py` - Tests subresource package
- `bae/repl/spaces/source/meta/{__init__,view,service}.py` - Meta subresource package
- `bae/repl/spaces/source/service.py` - Slimmed to SourceResourcespace only
- `bae/repl/spaces/source/__init__.py` - Imports from subresource packages, defines __all__
- `tests/test_source.py` - Updated meta test assertions for new symbol locations

## Decisions Made
- Meta's `_module_path` stays as `bae.repl.spaces.source.service` (not the package) because nav/read/edit need AST-parseable class and function definitions; the package's `__init__.py` only has imports. Enter message references the broader `bae.repl.spaces.source` for user orientation.
- Subresource view classes take `project_root: Path` in constructor and pass it as first argument to all service functions, keeping service functions pure/stateless.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Missing _hot_reload import in slimmed service.py**
- **Found during:** Task 2
- **Issue:** When removing unused imports from service.py, accidentally removed `_hot_reload` which SourceResourcespace.write() and edit() still use
- **Fix:** Added `_hot_reload` back to the models import block
- **Files modified:** bae/repl/spaces/source/service.py
- **Verification:** All 787 tests pass
- **Committed in:** c97148e (Task 2 commit)

**2. [Rule 1 - Bug] Meta test assertions referenced removed symbols**
- **Found during:** Task 2
- **Issue:** test_read_symbol tried to read DepsSubresource from meta (no longer in service.py); test_nav_lists_symbols asserted DepsSubresource in nav output (no longer there)
- **Fix:** Changed test_read_symbol to read SourceResourcespace.enter (a method that fits within CHAR_CAP); removed DepsSubresource assertion from nav test
- **Files modified:** tests/test_source.py
- **Verification:** All 787 tests pass
- **Committed in:** c97148e (Task 2 commit)

---

**Total deviations:** 2 auto-fixed (2 bugs)
**Impact on plan:** Both fixes necessary for correctness after extraction. No scope creep.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- All four subresource packages in place with consistent view/service convention
- Ready for 32.1.1-03 (whatever follows in the phase)
- source/service.py is clean with only SourceResourcespace

---
*Phase: 32.1.1-subresource-packages-shim-removal*
*Completed: 2026-02-16*

## Self-Check: PASSED
- All 12 created files exist
- Commits 95b7123 and c97148e verified in git log
