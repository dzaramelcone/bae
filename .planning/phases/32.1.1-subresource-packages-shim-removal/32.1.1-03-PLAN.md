---
phase: 32.1.1-subresource-packages-shim-removal
plan: 03
type: execute
wave: 2
depends_on: ["32.1.1-01"]
files_modified:
  - bae/repl/spaces/home/view.py
  - bae/repl/spaces/home/service.py
  - bae/repl/spaces/home/__init__.py
autonomous: true

must_haves:
  truths:
    - "home/view.py defines HomeResourcespace class with public API methods"
    - "home/service.py retains implementation functions (now called by view)"
    - "home/__init__.py re-exports from view.py with __all__"
    - "All tests pass — behavior identical"
  artifacts:
    - path: "bae/repl/spaces/home/view.py"
      provides: "HomeResourcespace public API"
      contains: "class HomeResourcespace"
    - path: "bae/repl/spaces/home/__init__.py"
      provides: "Selective re-exports"
      contains: "__all__"
  key_links:
    - from: "bae/repl/spaces/home/view.py"
      to: "bae/repl/spaces/home/service.py"
      via: "delegation"
      pattern: "from bae\\.repl\\.spaces\\.home import service"
---

<objective>
Split home/ into view.py + service.py convention. Create HomeResourcespace class in view.py that wraps the existing service functions with public-facing names.

Purpose: Home follows the same view/service convention as source/ and all subresource packages.
Output: home/view.py with HomeResourcespace, home/__init__.py with selective exports.
</objective>

<execution_context>
@/Users/dzaramelcone/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dzaramelcone/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32.1.1-subresource-packages-shim-removal/32.1.1-RESEARCH.md
@.planning/phases/32.1.1-subresource-packages-shim-removal/32.1.1-01-SUMMARY.md

@bae/repl/spaces/home/__init__.py
@bae/repl/spaces/home/service.py
@bae/repl/spaces/home/view.py
@bae/repl/ai.py (lines 35-45 for home imports)
@bae/repl/shell.py (lines 230-240 for home imports)
@bae/repl/tools.py (lines 45-55 for home imports)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HomeResourcespace in view.py and update exports</name>
  <files>
    bae/repl/spaces/home/view.py
    bae/repl/spaces/home/service.py
    bae/repl/spaces/home/__init__.py
  </files>
  <action>
    1. **home/service.py** — Keep existing implementation functions as-is. They already have the right signatures. Rename the underscore-prefixed functions to drop the `_exec_` prefix for cleaner service-layer naming, BUT only internally — the current callers (ai.py, shell.py, tools.py) import these by their `_exec_*` names via `home/__init__.py`. So:
       - Actually, keep the function names as `_exec_read`, `_exec_write`, etc. in service.py (matching existing codebase style)
       - The view class will wrap them with public names

    2. **home/view.py** — Create a minimal `HomeResourcespace` class:
       ```python
       class HomeResourcespace:
           """Home resourcespace: filesystem tools at root context."""
           name = "home"
           description = "Filesystem tools"

           def read(self, target: str = "") -> str:
               return service._exec_read(target)

           def write(self, filepath: str, content: str = "") -> str:
               return service._exec_write(filepath, content)

           def edit_read(self, target: str = "") -> str:
               return service._exec_edit_read(target)

           def edit_replace(self, filepath: str, start: int, end: int, content: str = "") -> str:
               return service._exec_edit_replace(filepath, start, end, content)

           def glob(self, pattern: str = "") -> str:
               return service._exec_glob(pattern)

           def grep(self, pattern: str = "") -> str:
               return service._exec_grep(pattern)
       ```
       Import: `from bae.repl.spaces.home import service`

    3. **home/__init__.py** — Update to export from view.py primarily, but ALSO re-export the _exec_* functions for backward compat with current callers (ai.py, shell.py, tools.py all import `_exec_read` etc. from `bae.repl.spaces.home`). This is NOT a shim — it's the package's public API which includes both the class and the tool functions:
       ```python
       from bae.repl.spaces.home.view import HomeResourcespace
       from bae.repl.spaces.home.service import (
           _exec_read, _exec_write, _exec_edit_read,
           _exec_edit_replace, _exec_glob, _exec_grep,
           _MAX_TOOL_OUTPUT,
       )
       __all__ = [
           "HomeResourcespace",
           "_exec_read", "_exec_write", "_exec_edit_read",
           "_exec_edit_replace", "_exec_glob", "_exec_grep",
           "_MAX_TOOL_OUTPUT",
       ]
       ```

    Note: The existing callers (ai.py line 38 `from bae.repl.spaces.home.service import ...`) were updated to `from bae.repl.spaces.home import ...` in plan 01. If plan 01 already did this, great. If not, verify and fix here.
  </action>
  <verify>uv run pytest tests/ -x -q --ignore=tests/test_integration.py</verify>
  <done>home/view.py has HomeResourcespace class, home/__init__.py has __all__ with selective exports, home/service.py unchanged, all tests pass.</done>
</task>

</tasks>

<verification>
- `uv run pytest tests/ -x -q --ignore=tests/test_integration.py` — all tests pass
- `python -c "from bae.repl.spaces.home import HomeResourcespace; print(HomeResourcespace.name)"` — prints "home"
- `python -c "from bae.repl.spaces.home import _exec_read"` — still importable (backward compat)
- `grep "__all__" bae/repl/spaces/home/__init__.py` — present
</verification>

<success_criteria>
Home package follows view/service convention. HomeResourcespace class exists and delegates to service functions. All existing callers still work. Tests pass.
</success_criteria>

<output>
After completion, create `.planning/phases/32.1.1-subresource-packages-shim-removal/32.1.1-03-SUMMARY.md`
</output>
