---
phase: 32.1.1-subresource-packages-shim-removal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bae/repl/spaces/view.py
  - bae/repl/spaces/__init__.py
  - bae/repl/spaces/source/service.py
  - bae/repl/spaces/source/models.py
  - bae/repl/shell.py
  - bae/repl/tools.py
  - bae/repl/ai.py
  - bae/repl/resource.py
  - bae/repl/source.py
autonomous: true

must_haves:
  truths:
    - "All protocol types (Resourcespace, ResourceRegistry, ResourceHandle, ResourceError, NavResult, etc.) are defined in bae/repl/spaces/view.py"
    - "bae/repl/resource.py and bae/repl/source.py are deleted"
    - "All production imports use canonical bae.repl.spaces paths"
    - "All 787 tests pass with no import warnings"
  artifacts:
    - path: "bae/repl/spaces/view.py"
      provides: "Protocol definitions (moved from resource.py)"
      contains: "class Resourcespace"
    - path: "bae/repl/spaces/__init__.py"
      provides: "Re-exports from spaces/view.py"
      contains: "from bae.repl.spaces.view import"
  key_links:
    - from: "bae/repl/spaces/__init__.py"
      to: "bae/repl/spaces/view.py"
      via: "re-export"
      pattern: "from bae\\.repl\\.spaces\\.view import"
    - from: "bae/repl/shell.py"
      to: "bae/repl/spaces"
      via: "canonical import"
      pattern: "from bae\\.repl\\.spaces import"
---

<objective>
Relocate the Resourcespace protocol from bae/repl/resource.py into bae/repl/spaces/view.py, update all production callsites to canonical bae.repl.spaces imports, and delete both backward-compat shims (resource.py and source.py).

Purpose: Establish spaces/view.py as the single definition site for protocol types, eliminating indirection through shims.
Output: Protocol lives in spaces/view.py, all imports canonical, shims deleted.
</objective>

<execution_context>
@/Users/dzaramelcone/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dzaramelcone/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32.1.1-subresource-packages-shim-removal/32.1.1-RESEARCH.md

@bae/repl/resource.py
@bae/repl/source.py
@bae/repl/spaces/__init__.py
@bae/repl/spaces/view.py
@bae/repl/shell.py
@bae/repl/tools.py
@bae/repl/ai.py
@bae/repl/spaces/source/service.py
@bae/repl/spaces/source/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move protocol to spaces/view.py and update all imports</name>
  <files>
    bae/repl/spaces/view.py
    bae/repl/spaces/__init__.py
    bae/repl/shell.py
    bae/repl/tools.py
    bae/repl/ai.py
    bae/repl/spaces/source/service.py
    bae/repl/spaces/source/models.py
  </files>
  <action>
    1. Replace the placeholder `bae/repl/spaces/view.py` with the full contents of `bae/repl/resource.py` (all 308 lines — NavResult, Resourcespace, ResourceError, ResourceRegistry, ResourceHandle, format_unsupported_error, format_nav_error, MAX_STACK_DEPTH, _TOOL_NAMES). Keep the `from bae.repl.views import _rich_to_ansi` import unchanged — no circular dependency risk (verified).

    2. Update `bae/repl/spaces/__init__.py` to import from `bae.repl.spaces.view` instead of `bae.repl.resource`. Keep the same exported names.

    3. Update production callsites (exact changes from research):
       - `bae/repl/shell.py:27`: `from bae.repl.resource import ResourceRegistry, ResourceHandle` → `from bae.repl.spaces import ResourceRegistry, ResourceHandle`
       - `bae/repl/tools.py:12`: `from bae.repl.resource import ResourceError, ResourceRegistry, format_unsupported_error` → `from bae.repl.spaces import ResourceError, ResourceRegistry, format_unsupported_error`
       - `bae/repl/ai.py:29` (TYPE_CHECKING): `from bae.repl.resource import ResourceRegistry` → `from bae.repl.spaces import ResourceRegistry`
       - `bae/repl/spaces/source/service.py:19`: `from bae.repl.resource import ResourceError, Resourcespace` → `from bae.repl.spaces.view import ResourceError, Resourcespace` (within spaces package, import from view.py directly to avoid __init__.py cycle)
       - `bae/repl/spaces/source/models.py:15`: `from bae.repl.resource import ResourceError` → `from bae.repl.spaces.view import ResourceError` (same reason — within spaces package)

    Note: Test files already use `from bae.repl.spaces import ...` — no test changes needed.
  </action>
  <verify>uv run pytest tests/ -x -q --ignore=tests/test_integration.py</verify>
  <done>All protocol types defined in spaces/view.py, all production files import from bae.repl.spaces (or bae.repl.spaces.view within the package), all tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Delete shims and audit for stale re-exports</name>
  <files>
    bae/repl/resource.py
    bae/repl/source.py
    bae/repl/spaces/source/schemas.py
  </files>
  <action>
    1. Delete `bae/repl/resource.py` — protocol now lives in spaces/view.py, all callsites updated.

    2. Delete `bae/repl/source.py` — re-export shim with zero consumers (confirmed by grep in research).

    3. Delete `bae/repl/spaces/source/schemas.py` — 1-line placeholder "reserved for future use", decision says remove empty placeholders.

    4. Audit `bae/repl/` for any other re-export patterns or stale imports referencing deleted files. Run:
       - `grep -r "from bae.repl.resource" bae/` should return zero hits
       - `grep -r "from bae.repl.source" bae/` should return zero hits
       - `grep -r "import resource" bae/repl/` to catch any relative imports

    5. If any remaining references found, update them to canonical paths.
  </action>
  <verify>
    uv run pytest tests/ -x -q --ignore=tests/test_integration.py
    grep -r "from bae.repl.resource" bae/ (expect zero hits)
    grep -r "bae.repl.source" bae/ (expect zero hits)
  </verify>
  <done>resource.py and source.py deleted, schemas.py placeholder deleted, no stale imports remain anywhere in the codebase, all tests pass.</done>
</task>

</tasks>

<verification>
- `uv run pytest tests/ -x -q --ignore=tests/test_integration.py` — all 787 tests pass
- `grep -rn "from bae.repl.resource" bae/` — zero hits
- `grep -rn "from bae.repl.source" bae/` — zero hits
- `python -c "from bae.repl.spaces import Resourcespace, ResourceRegistry, ResourceHandle, ResourceError, NavResult"` — imports succeed
- `ls bae/repl/resource.py bae/repl/source.py` — files do not exist
</verification>

<success_criteria>
Protocol types live exclusively in bae/repl/spaces/view.py. All imports are canonical. Both shims and all placeholder files are deleted. Full test suite passes.
</success_criteria>

<output>
After completion, create `.planning/phases/32.1.1-subresource-packages-shim-removal/32.1.1-01-SUMMARY.md`
</output>
