---
phase: 32.1.1-subresource-packages-shim-removal
plan: 01
subsystem: api
tags: [protocol, refactor, imports, resourcespace]

requires:
  - phase: 32.1-resourcespace-package-structure
    provides: spaces/ package layout with source subpackage
provides:
  - Protocol types defined exclusively in bae/repl/spaces/view.py
  - All production imports canonical (bae.repl.spaces or bae.repl.spaces.view)
  - Backward-compat shims resource.py and source.py deleted
affects: [32.1.1-02, 32.1.1-03, 32.1.1-04]

tech-stack:
  added: []
  patterns: [within-package imports use spaces.view directly to avoid __init__ cycle]

key-files:
  created:
    - bae/repl/spaces/view.py
  modified:
    - bae/repl/spaces/__init__.py
    - bae/repl/shell.py
    - bae/repl/tools.py
    - bae/repl/ai.py
    - bae/repl/spaces/source/service.py
    - bae/repl/spaces/source/models.py
    - tests/test_source.py

key-decisions:
  - "Within spaces/ package, import from view.py directly to avoid __init__.py circular dependency"
  - "Delete empty schemas.py placeholder along with shims"

patterns-established:
  - "Protocol definition site: bae.repl.spaces.view (single source of truth)"
  - "External code imports from bae.repl.spaces; internal spaces code imports from bae.repl.spaces.view"

duration: 4min
completed: 2026-02-16
---

# Phase 32.1.1 Plan 01: Protocol Relocation and Shim Removal Summary

**Resourcespace protocol relocated from resource.py to spaces/view.py with all imports canonical and both shims deleted**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-16T19:23:31Z
- **Completed:** 2026-02-16T19:27:58Z
- **Tasks:** 2
- **Files modified:** 10

## Accomplishments
- All protocol types (Resourcespace, ResourceRegistry, ResourceHandle, ResourceError, NavResult, etc.) now defined exclusively in bae/repl/spaces/view.py
- All production callsites updated to canonical bae.repl.spaces imports
- Both backward-compat shims (resource.py, source.py) and empty placeholder (schemas.py) deleted
- All 787 tests pass with zero stale references

## Task Commits

Each task was committed atomically:

1. **Task 1: Move protocol to spaces/view.py and update all imports** - `5e8e3d2` (feat)
2. **Task 2: Delete shims and audit for stale re-exports** - `d215eb6` (fix)

## Files Created/Modified
- `bae/repl/spaces/view.py` - Protocol definitions (created, was placeholder)
- `bae/repl/spaces/__init__.py` - Re-exports from view.py instead of resource.py
- `bae/repl/shell.py` - Import from bae.repl.spaces
- `bae/repl/tools.py` - Import from bae.repl.spaces
- `bae/repl/ai.py` - TYPE_CHECKING import from bae.repl.spaces
- `bae/repl/spaces/source/service.py` - Import from bae.repl.spaces.view
- `bae/repl/spaces/source/models.py` - Import from bae.repl.spaces.view
- `bae/repl/resource.py` - Deleted (protocol moved to spaces/view.py)
- `bae/repl/source.py` - Deleted (re-export shim, zero consumers)
- `bae/repl/spaces/source/schemas.py` - Deleted (empty placeholder)
- `tests/test_source.py` - Updated references from bae.repl.resource to bae.repl.spaces.view

## Decisions Made
- Within the spaces/ package, service.py and models.py import directly from `bae.repl.spaces.view` rather than `bae.repl.spaces` to avoid potential __init__.py circular dependency
- Deleted schemas.py placeholder alongside the shims since it contained only a docstring

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Updated test references to deleted module**
- **Found during:** Task 2 (Delete shims)
- **Issue:** tests/test_source.py had 12 references to `bae.repl.resource` as test fixtures for path resolution, read, glob, and grep tests
- **Fix:** Updated all references to use `bae.repl.spaces.view` as the equivalent module
- **Files modified:** tests/test_source.py
- **Verification:** All 787 tests pass
- **Committed in:** d215eb6 (Task 2 commit)

---

**Total deviations:** 1 auto-fixed (1 bug)
**Impact on plan:** Necessary to maintain test correctness after shim deletion. No scope creep.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Protocol is now in its canonical location (spaces/view.py)
- Ready for 32.1.1-02 (subresource package restructuring)
- All imports are clean with no indirection through shims

---
*Phase: 32.1.1-subresource-packages-shim-removal*
*Completed: 2026-02-16*
