---
status: complete
phase: 32.2-userview-tool-call-stripping
source: [32.2-01-SUMMARY.md, 32.2-02-SUMMARY.md, 32.2-03-SUMMARY.md]
started: 2026-02-16T21:15:00Z
updated: 2026-02-16T21:30:00Z
---

## Current Test

[testing complete]

## Tests

### 1. Tool calls show diamond-bullet format
expected: After navigating into a resource (e.g., `source()`), use a tool like `read("bae")`. The tool call display should show a one-liner like `◆ read(bae) -> str (N lines)` — not the full output dump. Clean single line with diamond bullet.
result: issue
reported: "No diamond-bullet format visible. glob() result shows as raw output in ai:1 panel box. read('bae') shows [py] prefix still. No ◆ anywhere."
severity: major

### 2. Resource context prefix on tool summaries
expected: While inside a resource (e.g., source), tool summaries show `[source] ◆ read(bae) -> str`. At home (no resource), the prefix is absent — just `◆ ...`.
result: issue
reported: "Same root cause as test 1 — AI calls namespace callables directly as Python execution, not through run_tool_calls/tool_translated path. Execution blocks render instead of summaries."
severity: major

### 3. Error tool calls render in red
expected: Trigger an error tool call (e.g., `read("nonexistent.module")` in source). The tool summary line should render in red with the exception type as return type, like `[source] ◆ read(nonexistent.module) -> ResourceError`.
result: skipped
reason: Blocked by test 1/2 — same rendering path issue

### 4. Intermediate AI prose suppressed
expected: When the AI processes multiple tool calls in sequence, only the final AI response after all tools resolve should display. No intermediate "Let me check that file" or "I'll look at..." prose between tool calls.
result: skipped
reason: Blocked by test 1/2 — AI uses direct callables not XML tool calls, so intermediate response suppression path doesn't fire

### 5. Functions table shows typed XML signatures on resource entry
expected: Navigate into a resource with `source()`. The entry display functions table should show `| Tool | Signature | Description |` headers with rows like `| read | <Read:target:str> | ... |`. Write tool shows body-content format with closing tag.
result: pass

### 6. Pydantic validation on bad tool params
expected: Call a tool with wrong parameter type or missing required param. Should return a clear error message showing the expected signature and docstring — not a raw Python TypeError.
result: issue
reported: "read(325035) gives raw TypeError from _validate_module_path. Pydantic validation is on ToolRouter.dispatch() but namespace callables bypass the router entirely — direct Python call."
severity: major

## Summary

total: 6
passed: 1
issues: 3
pending: 0
skipped: 2

## Gaps

- truth: "Tool calls display as diamond-bullet one-liners like ◆ read(bae) -> str (N lines)"
  status: failed
  reason: "User reported: No diamond-bullet format visible. glob() result shows as raw output in ai:1 panel box. read('bae') shows [py] prefix still. No ◆ anywhere. AI calls namespace callables directly as Python execution blocks, not through run_tool_calls XML path. Need to summarize direct callable results too."
  severity: major
  test: 1
  artifacts: []
  missing: []
- truth: "Resource context prefix [source] shown on tool summaries inside a resource"
  status: failed
  reason: "User reported: Same root cause — execution blocks render instead of summaries because AI uses direct callables not XML tool calls."
  severity: major
  test: 2
  artifacts: []
  missing: []
- truth: "Bad tool params return pydantic validation error with signature hint, not raw TypeError"
  status: failed
  reason: "User reported: read(325035) gives raw TypeError. Pydantic validation on ToolRouter.dispatch() but namespace callables bypass the router — direct Python call."
  severity: major
  test: 6
  artifacts: []
  missing: []
