# Phase 32.2: UserView Tool Call Stripping - Context

**Gathered:** 2026-02-16
**Status:** Ready for planning

<domain>
## Phase Boundary

Strip tool call noise from UserView display. Each tool call gets a dedicated summary line with call signature and return type. Intermediate AI prose is hidden; only the final response renders. Resource entry functions table shows XML tool tags with full typed signatures. Tool parameters validated via pydantic with helpful error messages.

</domain>

<decisions>
## Implementation Decisions

### Display stripping
- Tool calls render as: `◆ read(my_args) -> str` — one line per call with bullet, call signature, arrow, return type
- Error tool calls render in red: `◆ read(my_args) -> ResourceError`
- Intermediate AI prose (between tool calls) is completely hidden in UserView
- Only the AI's final response (after all tools resolve) renders as `[ai]` prefixed text
- `<run>` block panels (code+output) stay as-is — they're the interesting part
- Render each tool result as it completes — sequential execution, immediate display per completion
- View cycling (Ctrl+V) handles "expand" — no new toggle mechanism needed

### Tool tag format on resource entry
- Functions table keeps current layout, but Tool column shows XML tag syntax with full typed signature
- Example: `<Read:path:str>` or `<Edit:path:str, old:str, new:str>`
- Inline params with type hints — all parameters shown, not just primary
- Docstrings pulled directly from the callable's docstring — no modification
- Body content for multi-line tools (Write, Edit) keeps current `<W:path>content</W>` format

### Tool parameter validation
- Pydantic validation on tool call parameters with helpful error messages
- Similar to FastAPI's Query()/Form() pattern — investigate if Field() works for method params
- Validation errors return clear messages guiding the AI to correct its call

### AI response filtering
- Intermediate AI responses (orchestration prose between tool calls) completely hidden in UserView
- Only tool summary lines + final AI response shown
- DebugView shows full tracebacks for errors; UserView shows type only
- Current `[ai]` prefix rendering for final responses stays unchanged

### Context history
- Keep `--resume` session management as-is — no own history management this phase
- Display-side changes only — what the LM sees is unchanged
- Context % reporting on toolbar deferred (depends on CLI payload inspection)

### Claude's Discretion
- Exact bullet styling and colors for tool summary lines (beyond red for errors)
- How to handle the async yield of tool results without adding streaming complexity
- Pydantic model structure for tool parameter validation

</decisions>

<specifics>
## Specific Ideas

- Tool summary format: `◆ read(my_args) -> str` — the `◆` bullet, call with args, arrow to return type
- Red coloring for error returns — type name only in UserView, traceback in DebugView
- "dont pollute session context" — view cycling is the mechanism for seeing more detail, not inline expansion

</specifics>

<deferred>
## Deferred Ideas

- Own conversation history management (replacing --resume) — big project, defer to future phase
- Context % of max reporting on toolbar — needs CLI payload inspection
- Docstring length linter rule — separate cleanup concern

</deferred>

---

*Phase: 32.2-userview-tool-call-stripping*
*Context gathered: 2026-02-16*
