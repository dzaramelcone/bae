---
phase: 01.1-deps-signature-extension
plan: 01
subsystem: compiler
tags: [dspy, type-hints, dependency-injection, annotations]

# Dependency graph
requires:
  - phase: 01-signature-generation
    provides: node_to_signature() function and Context marker
provides:
  - Dep marker for __call__ parameter annotation
  - Extended node_to_signature() reading __call__ type hints
  - Combined Context fields + Dep params as InputFields
affects: [02-two-step-validation, graph-execution, dspy-optimization]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Marker-based annotation pattern (Annotated[type, Marker(description=...)])"
    - "Separate extraction helpers for different hint sources"

key-files:
  created: []
  modified:
    - bae/markers.py
    - bae/compiler.py
    - tests/test_compiler.py

key-decisions:
  - "Dep follows exact same pattern as Context (frozen dataclass with description)"
  - "Only process __call__ if defined in node_cls.__dict__ (not inherited)"
  - "Skip self, lm, return parameters - only additional Dep-annotated params"

patterns-established:
  - "Marker annotation: Annotated[type, Marker(description='...')] for DSPy InputField generation"
  - "Helper extraction: _extract_*() functions for different hint sources"

# Metrics
duration: 3min
completed: 2026-02-04
---

# Phase 1.1 Plan 01: Dep Marker and __call__ Param Signature Extension Summary

**Dep marker for __call__ params enabling dependency injection visibility in DSPy Signatures**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-04T23:49:11Z
- **Completed:** 2026-02-04T23:52:27Z
- **Tasks:** 2 (TDD RED + GREEN)
- **Files modified:** 3

## Accomplishments
- Dep frozen dataclass marker in markers.py following Context pattern
- node_to_signature() now reads __call__ type hints via get_type_hints()
- Dep-annotated params become InputFields alongside Context fields
- 13 new tests covering Dep marker and __call__ param extraction

## Task Commits

TDD cycle commits:

1. **RED: Add failing tests** - `8c7e560` (test)
2. **GREEN: Implement Dep marker and signature extension** - `eaf53e3` (feat)

## Files Created/Modified
- `bae/markers.py` - Added Dep frozen dataclass marker
- `bae/compiler.py` - Added _extract_context_fields(), _extract_dep_params(), extended node_to_signature()
- `tests/test_compiler.py` - Added TestDepMarker and TestDepAnnotatedCallParams test classes

## Decisions Made
- Dep follows exact same pattern as Context - frozen dataclass with description field
- Only process __call__ if defined directly on node class (check `__dict__`) to avoid pulling params from Node base class
- Skip `self`, `lm`, and `return` - these are not injectable dependencies

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Dep marker and signature extension complete
- Ready for Phase 2 two-step validation which will use Dep-annotated params
- All 47 tests pass (42 passed, 5 pre-existing skips)

---
*Phase: 01.1-deps-signature-extension*
*Completed: 2026-02-04*
