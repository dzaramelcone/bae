---
phase: 01.1-deps-signature-extension
verified: 2026-02-04T19:15:00Z
status: passed
score: 4/4 must-haves verified
---

# Phase 1.1: Deps & Signature Extension Verification Report

**Phase Goal:** Dep-annotated `__call__` params become InputFields in Signatures
**Verified:** 2026-02-04T19:15:00Z
**Status:** passed
**Re-verification:** No — initial verification

## Goal Achievement

### Observable Truths

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | Dep marker can be used in Annotated type hints | ✓ VERIFIED | Dep frozen dataclass exists in bae/markers.py (lines 22-39), test_dep_is_frozen_dataclass passes |
| 2 | node_to_signature() reads __call__ params | ✓ VERIFIED | _extract_dep_params() calls get_type_hints(node_cls.__call__) (line 77), test_dep_annotated_call_param_becomes_input_field passes |
| 3 | Dep-annotated __call__ params become InputFields | ✓ VERIFIED | isinstance(meta, Dep) check creates InputField (lines 95-96), 7 tests verify this behavior, all pass |
| 4 | Context fields and Dep params both appear as InputFields | ✓ VERIFIED | node_to_signature() calls both _extract_context_fields() and _extract_dep_params() (lines 120-123), test_context_and_dep_both_become_input_fields passes |

**Score:** 4/4 truths verified

### Required Artifacts

| Artifact | Expected | Status | Details |
|----------|----------|--------|---------|
| `bae/markers.py` | Dep frozen dataclass marker | ✓ VERIFIED | 39 lines, contains class Dep (line 22-39), frozen=True, description field, no stubs |
| `bae/compiler.py` | Extended node_to_signature() | ✓ VERIFIED | 148 lines, imports Dep (line 11), _extract_dep_params() function (lines 61-99), get_type_hints(__call__) (line 77), called in node_to_signature() (line 123) |
| `tests/test_compiler.py` | TDD tests for Dep marker and __call__ params | ✓ VERIFIED | 263 lines, TestDepMarker class (3 tests), TestDepAnnotatedCallParams class (7 tests), all 20 compiler tests pass |

**All artifacts: Exist ✓, Substantive ✓, Wired ✓**

### Key Link Verification

| From | To | Via | Status | Details |
|------|----|----|--------|---------|
| bae/compiler.py | bae/markers.py | import Dep | ✓ WIRED | Line 11: `from bae.markers import Context, Dep` |
| bae/compiler.py | node_cls.__call__ | get_type_hints | ✓ WIRED | Line 77: `get_type_hints(node_cls.__call__, include_extras=True)` in _extract_dep_params() |
| node_to_signature() | _extract_dep_params() | function call | ✓ WIRED | Line 123: `fields.update(_extract_dep_params(node_cls))` |
| _extract_dep_params() | dspy.InputField | creation | ✓ WIRED | Line 96: `fields[name] = (base_type, dspy.InputField(desc=meta.description))` when Dep marker found |

**All key links verified as connected and functional.**

### Requirements Coverage

Phase 1.1 requirements from ROADMAP.md:
- SIG-03: Annotated fields become InputFields
- DEP-01: Dep marker for dependency injection

| Requirement | Status | Verification |
|-------------|--------|--------------|
| SIG-03 (extended) | ✓ SATISFIED | Both Context class fields AND Dep __call__ params become InputFields (truths 3+4) |
| DEP-01 | ✓ SATISFIED | Dep marker exists (truth 1), used in type hints, creates InputFields (truth 3) |

### Anti-Patterns Found

| File | Line | Pattern | Severity | Impact |
|------|------|---------|----------|--------|
| bae/compiler.py | 27, 31, 36 | TODO comments in CompiledGraph methods | ℹ️ Info | Out of scope for Phase 1.1 — these are Phase 2+ work items (DSPy integration), not stubs in Phase 1.1 deliverables |

**No blockers or warnings.** The TODO comments are in CompiledGraph.run() and CompiledGraph.optimize(), which are explicitly future work (Phase 2-3). Phase 1.1 scope was node_to_signature() extension only.

### Test Coverage

**All compiler tests pass: 20/20 (100%)**

```
TestNodeToSignature: 7 tests (Phase 1 baseline)
TestContextMarker: 3 tests (Phase 1 baseline)  
TestDepMarker: 3 tests (Phase 1.1 new)
TestDepAnnotatedCallParams: 7 tests (Phase 1.1 new)
```

**Phase 1.1 specific tests:**
- test_dep_is_frozen_dataclass ✓
- test_dep_holds_description ✓
- test_dep_equality ✓
- test_dep_annotated_call_param_becomes_input_field ✓
- test_multiple_dep_params_become_input_fields ✓
- test_context_and_dep_both_become_input_fields ✓
- test_unannotated_call_param_excluded ✓
- test_self_and_lm_excluded ✓
- test_node_with_only_dep_params ✓
- test_node_without_custom_call ✓

**Test Quality:** All tests use real node_to_signature() function with real Node classes. No mocks of core behavior. Tests verify actual DSPy Signature field creation, not just function calls.

### Implementation Quality Checks

**Dep marker (bae/markers.py):**
- ✓ Frozen dataclass (immutable)
- ✓ Matches Context pattern exactly (consistency)
- ✓ Clear docstring with usage example
- ✓ Exported and importable

**_extract_dep_params() (bae/compiler.py):**
- ✓ Guards against missing __call__ (checks __dict__)
- ✓ Exception handling for get_type_hints
- ✓ Skips self, lm, return (internal params)
- ✓ Only processes Annotated[type, Dep(...)] (explicit opt-in)
- ✓ Returns empty dict for nodes without custom __call__

**node_to_signature() integration:**
- ✓ Calls both _extract_context_fields() and _extract_dep_params()
- ✓ Fields dict merge (no conflicts - class fields vs call params)
- ✓ Preserves existing Context field behavior
- ✓ Output field still created correctly

### Edge Cases Verified

1. ✓ Node with only Context fields (no __call__ override)
2. ✓ Node with only Dep params (no Context fields)
3. ✓ Node with both Context + Dep
4. ✓ Unannotated __call__ params excluded
5. ✓ Multiple Dep-annotated params
6. ✓ Node using base class __call__ (no custom __call__)
7. ✓ self and lm always excluded

## Summary

**Phase 1.1 goal ACHIEVED.**

All four success criteria verified:
1. ✓ Dep marker exists as frozen dataclass
2. ✓ node_to_signature() reads __call__ type hints
3. ✓ Dep-annotated params become InputFields
4. ✓ Both Context fields and Dep params appear together

**Implementation is:**
- Complete (all planned features work)
- Tested (10 new tests, all passing)
- Consistent (follows established Context pattern)
- Robust (handles edge cases and missing __call__)
- Clean (no stubs, clear separation via helper functions)

**Ready for Phase 2:** Next phase (DSPy Integration) can now use Dep-annotated params for dependency injection, with those dependencies visible to the LLM during optimization.

---

_Verified: 2026-02-04T19:15:00Z_
_Verifier: Claude (gsd-verifier)_
