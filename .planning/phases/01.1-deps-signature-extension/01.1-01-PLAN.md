---
phase: 01.1-deps-signature-extension
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified: [bae/markers.py, bae/compiler.py, tests/test_compiler.py]
autonomous: true

must_haves:
  truths:
    - "Dep marker can be used in Annotated type hints"
    - "node_to_signature() reads __call__ params"
    - "Dep-annotated __call__ params become InputFields"
    - "Context fields and Dep params both appear as InputFields"
  artifacts:
    - path: "bae/markers.py"
      provides: "Dep frozen dataclass marker"
      contains: "class Dep"
    - path: "bae/compiler.py"
      provides: "Extended node_to_signature()"
      contains: "get_type_hints.*__call__"
    - path: "tests/test_compiler.py"
      provides: "TDD tests for Dep marker and __call__ params"
      contains: "test_dep_annotated_call_param_becomes_input_field"
  key_links:
    - from: "bae/compiler.py"
      to: "bae/markers.py"
      via: "import Dep"
      pattern: "from bae\\.markers import.*Dep"
    - from: "bae/compiler.py"
      to: "node_cls.__call__"
      via: "get_type_hints"
      pattern: "get_type_hints\\(node_cls\\.__call__"
---

<objective>
Extend node_to_signature() to include Dep-annotated `__call__` parameters as InputFields

Purpose: Dependency injection parameters need to appear in DSPy Signatures so the LM receives that context. This enables nodes to declare their runtime dependencies in a way that's visible to the optimization pipeline.

Output: Dep marker in markers.py, extended node_to_signature() in compiler.py, comprehensive TDD tests
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-signature-generation/01-01-SUMMARY.md
@bae/markers.py
@bae/compiler.py
@tests/test_compiler.py
</context>

<feature>
  <name>Dep Marker and __call__ Param Signature Extension</name>
  <files>bae/markers.py, bae/compiler.py, tests/test_compiler.py</files>
  <behavior>
    Dep marker - frozen dataclass like Context:
    - Dep(description="...") creates immutable marker instance
    - Can be used in Annotated[type, Dep(description="...")]

    node_to_signature() extended behavior:
    - Get type hints from node_cls.__call__ (include_extras=True)
    - Skip 'self', 'lm', and 'return' parameters
    - For each Dep-annotated param: create InputField with description
    - Combined output: Context fields + Dep params all become InputFields

    Cases:
    - Node with only Context fields -> InputFields from class fields only
    - Node with only Dep params -> InputFields from __call__ params only
    - Node with both Context + Dep -> both become InputFields
    - Dep param without Annotated wrapper -> excluded (internal)
    - Multiple Dep params -> all become InputFields
  </behavior>
  <implementation>
    1. Add Dep dataclass to markers.py (copy Context pattern)
    2. In node_to_signature():
       - After processing class fields, also process __call__ hints
       - Use get_type_hints(node_cls.__call__, include_extras=True)
       - Iterate params, check for Annotated + Dep marker
       - Add to fields dict with InputField(desc=...)
    3. Handle edge cases:
       - Node without __call__ defined (uses base class __call__)
       - __call__ with no Dep-annotated params
       - Skip 'self' (first param), 'lm' (second param), 'return' (return type)
  </implementation>
</feature>

<verification>
```bash
# Run all compiler tests
cd /Users/dzaramelcone/lab/bae && uv run pytest tests/test_compiler.py -v

# Verify Dep marker exists and is frozen
cd /Users/dzaramelcone/lab/bae && uv run python -c "from bae.markers import Dep; d = Dep(description='test'); print(f'Dep works: {d.description}')"

# Verify both Context and Dep are importable
cd /Users/dzaramelcone/lab/bae && uv run python -c "from bae.markers import Context, Dep; print('Both markers importable')"

# Run full test suite to verify no regressions
cd /Users/dzaramelcone/lab/bae && uv run pytest -v
```
</verification>

<success_criteria>
- [ ] Dep marker exists in bae/markers.py as frozen dataclass
- [ ] Tests exist for Dep-annotated __call__ params becoming InputFields
- [ ] node_to_signature() reads __call__ type hints
- [ ] Dep-annotated params appear as InputFields in Signature
- [ ] Both Context fields and Dep params appear as InputFields
- [ ] All existing tests still pass (no regressions)
- [ ] TDD cycle complete: RED -> GREEN commits
</success_criteria>

<output>
After completion, create `.planning/phases/01.1-deps-signature-extension/01.1-01-SUMMARY.md`
</output>
