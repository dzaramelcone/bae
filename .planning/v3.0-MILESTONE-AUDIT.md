---
milestone: v3.0
audited: 2026-02-09T10:00:00Z
status: passed
scores:
  requirements: 17/17
  phases: 2/2
  integration: 15/15
  flows: 5/5
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt: []
---

# Milestone v3.0 Audit: Async Graphs

**Audited:** 2026-02-09
**Status:** PASSED
**Phases:** 11 (Async Core), 12 (Parallel Deps + Migration)

## Requirements Coverage

| Requirement | Phase | Status | Evidence |
|-------------|-------|--------|----------|
| ASYNC-01: Graph.run() async | 11 | ✓ Satisfied | Split into sync run() + async arun() |
| ASYNC-02: LM protocol async | 11 | ✓ Satisfied | 4 async methods (make, decide, choose_type, fill) |
| ASYNC-03: PydanticAIBackend native async | 11 | ✓ Satisfied | await agent.run(), 0 sync wrappers |
| ASYNC-04: ClaudeCLIBackend async subprocess | 11 | ✓ Satisfied | asyncio.create_subprocess_exec() |
| ASYNC-05: DSPyBackend native async | 11 | ✓ Satisfied | await predictor.acall() |
| ASYNC-06: OptimizedLM async | 11 | ✓ Satisfied | Inherits from async DSPyBackend |
| ASYNC-07: Node.__call__() async | 11 | ✓ Satisfied | async def __call__ |
| ASYNC-08: CLI asyncio.run() boundary | 11 | ✓ Satisfied | graph.run() (sync wrapper) |
| ASYNC-09: CompiledGraph.run() async | 11 | ✓ Satisfied | Split into sync run() + async arun() |
| PDEP-01: Concurrent dep resolution | 12 | ✓ Satisfied | asyncio.gather() per topo level |
| PDEP-02: Sync/async callable mixing | 12 | ✓ Satisfied | inspect.iscoroutinefunction detection |
| PDEP-03: Topo ordering + parallelism | 12 | ✓ Satisfied | TopologicalSorter prepare/get_ready/done |
| PDEP-04: Race-free dep caching | 12 | ✓ Satisfied | Cache updated after gather completes |
| PDEP-05: Async resolve_fields/resolve_dep | 12 | ✓ Satisfied | Both async def |
| MIG-01: All tests pass | 12 | ✓ Satisfied | 334 passed, 10 skipped, 0 failed |
| MIG-02: ootd.py works | 12 | ✓ Satisfied | graph.run() (sync), no asyncio import |
| MIG-03: E2E tests pass | 13 | ✓ Satisfied | Fixed in Phase 13 — getattr extraction preserves nested models, 5/5 E2E pass |

**Coverage: 17/17 requirements satisfied**

## Phase Verification Summary

| Phase | Status | Score | Tests |
|-------|--------|-------|-------|
| 11: Async Core | ✓ Passed | 6/6 must-haves | 313 passed, 10 skipped |
| 12: Parallel Deps + Migration | ✓ Passed | 19/19 must-haves | 334 passed, 10 skipped |

## Cross-Phase Integration

| From | To | Via | Status |
|------|----|-----|--------|
| Graph.arun() | resolve_fields() | await at lines 270, 321 | ✓ Wired |
| Graph.arun() | lm.choose_type() | await at line 314 | ✓ Wired |
| Graph.arun() | lm.fill() | await at line 323 | ✓ Wired |
| Graph.arun() | Node.__call__() | await at lines 304, 306 | ✓ Wired |
| Graph.run() | Graph.arun() | asyncio.run() wrapper | ✓ Wired |
| CompiledGraph.run() | CompiledGraph.arun() | asyncio.run() wrapper | ✓ Wired |
| CompiledGraph.arun() | graph.arun() | await delegation | ✓ Wired |
| CLI | Graph.run() | Direct sync call | ✓ Wired |
| resolve_fields() | asyncio.gather() | Per-level parallel fire | ✓ Wired |
| _resolve_one() | inspect.iscoroutinefunction | Sync/async dispatch | ✓ Wired |
| PydanticAIBackend | agent.run() | await (native async) | ✓ Wired |
| ClaudeCLIBackend | create_subprocess_exec | await + wait_for timeout | ✓ Wired |
| DSPyBackend | predictor.acall() | await (native async) | ✓ Wired |
| OptimizedLM | DSPyBackend._call_with_retry | await inheritance | ✓ Wired |
| examples/ootd.py | Graph.run() | Direct sync call | ✓ Wired |

**Integration: 15/15 connections verified**

## E2E User Flows

| Flow | Path | Status |
|------|------|--------|
| Sync CLI usage | Typer → graph.run() → asyncio.run(arun()) → resolve_fields → lm.fill → result | ✓ Complete |
| Async programmatic | await graph.arun() → resolve_fields → lm.fill → result | ✓ Complete |
| Parallel dep resolution | Dep() fields → asyncio.gather() → cache → result | ✓ Complete |
| DSPy optimization | CompiledGraph.run() → OptimizedLM → predictor → result | ✓ Complete |
| Mixed sync/async deps | Dep(sync) + Dep(async) → both resolve correctly | ✓ Complete |

**Flows: 5/5 verified**

## Anti-Patterns

None found across either phase. No TODO/FIXME/HACK comments, no stub implementations, no asyncio.to_thread usage, no coroutine warnings.

## Critical Gaps

None. All gaps closed by Phase 13.

**Total: 0 blockers**

## Test Suite

| Metric | Value |
|--------|-------|
| Tests collected | 344 |
| Tests passed | 334 |
| Tests skipped | 10 (5 PydanticAI API key, 5 E2E flag) |
| Tests failed | 0 |
| Tests deleted | 0 |
| New tests (v3.0) | 21 (parallel dep coverage) |

## Commits (v3.0 scope)

| Hash | Phase | Description |
|------|-------|-------------|
| 3991ca6 | 11-01 | feat: convert LM Protocol and backends to async |
| 64a1431 | 11-01 | test: migrate LM protocol tests to async |
| 1b9eb1e | 11-02 | feat: convert DSPyBackend + OptimizedLM to async |
| 080cbd4 | 11-02 | test: migrate DSPy backend tests to async |
| b3eed3d | 11-03 | feat: convert node, graph, compiler to async |
| c0fd585 | 11-03 | feat: convert CLI to asyncio.run() boundary |
| c252953 | 11-03 | test: migrate all tests and examples to async |
| e77d49c | 12-01 | feat: async resolver with topo-sort gather |
| 75b9acc | 12-02 | feat: Graph run/arun split |
| 13b7048 | 12-02 | feat: update CompiledGraph, CLI, examples |
| 765f165 | 12-02 | test: migrate tests to arun() API |
| fcfd5e3 | 12-04 | test: add parallel dep resolution test suite |

---
*Audited: 2026-02-09*
*Auditor: Claude (gsd-audit-milestone)*
