---
milestone: v2.0
audited: 2026-02-08
status: passed
scores:
  requirements: 22/22
  phases: 6/6
  integration: 14/14
  flows: 4/4
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt:
  - phase: 09-json-structured-fill
    items:
      - "Root-cause --setting-sources '' breaking structured output (vague correlation, not understood)"
      - "5 E2E tests gated behind --run-e2e flag (requires live LLM)"
  - phase: 10-hint-annotation
    items:
      - "15 deprecation warnings from litellm dependency (not bae code)"
  - phase: global
    items:
      - "No system prompt in any LLM backend"
      - "PydanticAIBackend.choose_type uses free-text string + fuzzy matching (should constrain)"
      - "tests/traces/json_structured_fill_reference.py drifted from real backend"
---

# Milestone Audit: v2.0 Context Frames

**Audited:** 2026-02-08
**Status:** PASSED

## Milestone Definition

Redesigned the node API around "nodes as context frames" — Dep/Recall field annotations, implicit LM, JSON structured fill with constrained decoding, and explicit Field(description=...) hints.

## Requirements Coverage: 22/22

All v2.0 requirements satisfied. Full traceability:

### Dependency Injection (6/6)

| Requirement | Description | Phase | Status |
|-------------|-------------|-------|--------|
| DEP2-01 | Dep(callable) resolves fields | 5 | ✓ SATISFIED |
| DEP2-02 | Dep chaining resolves recursively | 5 | ✓ SATISFIED |
| DEP2-03 | Circular dep chains detected at build time | 5 | ✓ SATISFIED |
| DEP2-04 | Per-run dep caching | 5 | ✓ SATISFIED |
| DEP2-05 | Clear error when dep callable fails | 5 | ✓ SATISFIED |
| DEP2-06 | Dep fields on start node auto-resolved | 7 | ✓ SATISFIED |

### Trace & Recall (3/3)

| Requirement | Description | Phase | Status |
|-------------|-------------|-------|--------|
| RCL-01 | Recall searches trace backward | 5 | ✓ SATISFIED |
| RCL-02 | Clear error when target not found | 5 | ✓ SATISFIED |
| RCL-03 | Recall on start node raises error | 5 | ✓ SATISFIED |

### Node Semantics (4/4)

| Requirement | Description | Phase | Status |
|-------------|-------------|-------|--------|
| NODE-01 | Plain fields filled by LLM | 6 | ✓ SATISFIED |
| NODE-02 | Start node fields are caller-provided | 6 | ✓ SATISFIED |
| NODE-03 | Terminal node fields are response schema | 6 | ✓ SATISFIED |
| NODE-04 | Class name is instruction, docstrings inert | 6+10 | ✓ SATISFIED |

### LM Protocol (4/4)

| Requirement | Description | Phase | Status |
|-------------|-------------|-------|--------|
| LM-01 | LM implicit at graph level | 6 | ✓ SATISFIED |
| LM-02 | Per-node LM override via NodeConfig | 6 | ✓ SATISFIED |
| LM-03 | choose_type/fill protocol | 6 | ✓ SATISFIED |
| LM-04 | Dep/Recall as InputFields, plain as OutputFields | 6 | ✓ SATISFIED |

### Cleanup (5/5)

| Requirement | Description | Phase | Status |
|-------------|-------------|-------|--------|
| CLN-01 | Remove Context marker | 8 | ✓ SATISFIED |
| CLN-02 | Remove Bind marker | 8 | ✓ SATISFIED |
| CLN-03 | Remove incant dependency | 7 | ✓ SATISFIED |
| CLN-04 | All tests use v2 patterns | 8 | ✓ SATISFIED |
| CLN-05 | ootd.py runs E2E with v2 | 8 | ✓ SATISFIED |

## Phase Verification: 6/6

| Phase | Name | Plans | Verification Status | Score |
|-------|------|-------|---------------------|-------|
| 5 | Markers & Resolver | 4/4 | PASSED | 5/5 truths |
| 6 | Node & LM Protocol | 5/5 | PASSED | 5/5 truths |
| 7 | Integration | 4/4 | PASSED | 4/4 criteria |
| 8 | Cleanup & Migration | 4/4 | PASSED | 8/8 truths |
| 9 | JSON Structured Fill | 1/1 (spike) | PASSED | 6/6 criteria |
| 10 | Field Descriptions | 3/3 | PASSED (re-verified) | 8/8 truths |

**Notes:**
- Phase 9 was a spike (102 commits, no formal plans) — success criteria verified via ROADMAP.md
- Phase 10 required re-verification after 3 gaps found in initial pass; all closed by plan 10-03

## Cross-Phase Integration: 14/14

All phase exports properly wired. Zero orphaned exports. Zero missing connections.

| # | Connection | From | To | Status |
|---|------------|------|-----|--------|
| 1 | resolve_fields() | Phase 5 resolver | Phase 7 Graph.run() | ✓ WIRED |
| 2 | classify_fields() | Phase 5 resolver | Phase 6 compiler | ✓ WIRED |
| 3 | classify_fields() | Phase 5 resolver | Phase 9 lm.py | ✓ WIRED |
| 4 | _wants_lm() | Phase 6 node | Phase 7 Graph.run() | ✓ WIRED |
| 5 | choose_type/fill | Phase 6 LM protocol | Phase 7 Graph.run() | ✓ WIRED |
| 6 | node_to_signature() | Phase 6 compiler | DSPyBackend | ✓ WIRED |
| 7 | node_to_signature() | Phase 6 compiler | OptimizedLM | ✓ WIRED |
| 8 | Graph.run() v2 | Phase 7 | All consumers | ✓ WIRED |
| 9 | DepError/FillError | Phase 7 exceptions | Graph.run(), lm.py | ✓ WIRED |
| 10 | _build_fill_prompt() | Phase 9 | PydanticAI/ClaudeCLI | ✓ WIRED |
| 11 | _build_plain_model() | Phase 9 | PydanticAI/ClaudeCLI | ✓ WIRED |
| 12 | _strip_format() | Phase 9 | ClaudeCLI._run_cli_json | ✓ WIRED |
| 13 | Field descriptions preserved | Phase 10 | Phase 9 _build_plain_model | ✓ WIRED |
| 14 | Docstrings inert | Phase 10 | compiler.py, all backends | ✓ WIRED |

## E2E Flows: 4/4

### Flow 1: Graph Construction → Execution → Result
User defines nodes → Graph discovers topology → validate_node_deps → run → resolve deps → resolve recalls → LM fill → next node → terminal → GraphResult
**Status:** COMPLETE

### Flow 2: Dep/Recall Resolution → LM Fill
resolve_fields → resolve_dep (DAG topo sort) → recall_from_trace (backward search) → setattr → trace → choose_type/fill
**Status:** COMPLETE

### Flow 3: DSPy Optimization → Production
node_to_signature → compile_graph → BootstrapFewShot → save_optimized → create_optimized_lm → OptimizedLM.make() with compiled predictors
**Status:** COMPLETE

### Flow 4: OOTD Reference Example
3-node outfit graph: IsTheUserGettingDressed → AnticipateUsersDay → RecommendOOTD (terminal)
Deps (weather, schedule, location), recalls, LLM-filled fields, Field(description=...) for schema hints
**Status:** COMPLETE (structural validation; live LLM E2E gated behind --run-e2e)

## Backend Consistency

| Method | DSPyBackend | PydanticAIBackend | ClaudeCLIBackend |
|--------|:-----------:|:-----------------:|:----------------:|
| choose_type() | ✓ | ✓ | ✓ |
| fill() | ✓ | ✓ | ✓ |
| make() (v1) | ✓ | ✓ | ✓ |
| decide() (v1) | ✓ | ✓ | ✓ |
| __doc__ clean | ✓ | ✓ | ✓ |

## V1 Pattern Removal

| Pattern | Status |
|---------|--------|
| Context marker | ✓ Removed (ImportError on import) |
| Bind marker | ✓ Removed (ImportError on import) |
| incant dependency | ✓ Removed from pyproject.toml |
| format_as_xml | ✓ Zero references |

## Test Suite

```
323 passed, 5 skipped, 0 failures
```

- 5 skipped: PydanticAI integration tests requiring API key
- 5 E2E tests gated behind --run-e2e flag (by design)
- 15 deprecation warnings from litellm (external dependency)

## Tech Debt

| Phase | Item | Severity |
|-------|------|----------|
| 9 | Root-cause `--setting-sources ""` breaking structured output | Low |
| 9 | 5 E2E tests gated behind --run-e2e | Low (by design) |
| 10 | 15 litellm deprecation warnings | Low (external) |
| Global | No system prompt in any LLM backend | Medium |
| Global | PydanticAIBackend.choose_type uses free-text + fuzzy matching | Medium |
| Global | json_structured_fill_reference.py drifted from real backend | Low |

**Total:** 6 items across 3 phases + global
**Critical blockers:** 0
**Medium items:** 2 (system prompt, PydanticAI choose_type)

## Milestone Stats

- **Phases:** 6 (phases 5-10)
- **Plans completed:** 21
- **Commits:** 106
- **Duration:** 2 days (2026-02-07 → 2026-02-08)
- **Source lines:** 2,718
- **Test lines:** 6,298
- **Total tests:** 323

## Conclusion

v2.0 **passed**. All 22 requirements satisfied. All 6 phases verified. All 14 cross-phase connections wired. All 4 E2E flows complete. Zero critical gaps. 6 tech debt items tracked, none blocking.

---
*Audited: 2026-02-08*
*Auditor: Mah (gsd audit-milestone orchestrator)*
*Integration checker: Claude (gsd-integration-checker)*
