---
milestone: v6.0
audited: 2026-02-16T02:30:00Z
status: tech_debt
scores:
  requirements: 18/25
  phases: 5/5
  integration: 42/42
  flows: 2/2
gaps:
  requirements:
    - "MODE-01: GRAPH mode command parser (removed by quick task 1)"
    - "MODE-03: list command (removed)"
    - "MODE-04: cancel <id> command (removed)"
    - "MODE-05: inspect <id> command (removed)"
    - "GATE-05: shush toggle (removed)"
    - "OBS-05: debug command with asyncio.capture_call_graph (removed)"
  integration: []
  flows: []
tech_debt:
  - phase: quick-1
    items:
      - "MODE-01 through MODE-05: GRAPH mode commands removed — infrastructure survives programmatically"
      - "GATE-05: shush toggle removed with GRAPH mode"
      - "OBS-05: debug command removed — asyncio.capture_call_graph available via Python API"
      - "MODE-06, GATE-03, OBS-03: partially affected — @g routing and data survive, commands gone"
      - "GraphRegistry.active() and .get() are now unused (orphaned API surface)"
  - phase: 30-agent-core-extraction
    items:
      - "AgenticBackend removed — intentional; agentic fill will use model config on nodes instead"
      - "Phase 30 VERIFICATION.md stale (claims 11/11 but AgenticBackend removed; extract_executable intact)"
  - phase: pre-existing
    items:
      - "tests/traces/json_structured_fill_reference.py drifted from real backend"
      - "AI streaming/progressive display deferred"
      - "work/models.py: RoadmapData.phases is list[dict], ProjectState.status is bare str"
      - "work/deps.py: scan_secrets() and detect_brownfield() are stubs"
---

# v6.0 Graph Runtime — Milestone Audit (Revised)

**Milestone Goal:** Run bae graphs async inside cortex with concurrent execution, human-in-the-loop input gates, and full observability through the view system.

**Audited:** 2026-02-16 (revision — accounts for quick task 1 GRAPH mode removal + quick task 2 refactor)
**Status:** tech_debt (no blockers, accumulated debt from GRAPH mode removal)

## Phase Verification Summary

| Phase | Status | Score | Notes |
|-------|--------|-------|-------|
| 26: Engine Foundation | passed | 8/8 | Re-verified after UAT gap closure (26-03, 26-04) |
| 27: Graph Mode | passed | 12/12 | Then partially removed by quick task 1 |
| 28: Input Gates | passed | 5/5 | Initial verification |
| 29: Observability | passed | 3/3 | UAT gaps fixed in 101a5d8 + b171b0b |
| 30: Agent Core Extraction | passed | 11/11 | AgenticBackend intentionally removed post-verification |

All 5 phases passed verification at time of completion. Quick tasks 1 and 2 modified the codebase after phase verification.

## Requirements Coverage

### Satisfied (18/25)

| Requirement | Phase | Evidence |
|---|---|---|
| ENG-01 | 26 | GraphRegistry tracks by ID with lifecycle states |
| ENG-02 | 26 | _lifecycle() context manager wraps arun() |
| ENG-03 | 26 | TimingLM, NodeTiming, DEP_TIMING_KEY |
| ENG-04 | 26 | Backend-agnostic, any LM protocol object works |
| ENG-05 | 26 | dep_cache parameter on arun(), backward compatible |
| GATE-01 | 28 | asyncio.Future-based InputGate with WAITING state |
| GATE-02 | 28 | make_gates_widget in toolbar, visible in all modes |
| GATE-04 | 28 | InputGate.schema_display property |
| OBS-01 | 29 | _lifecycle emits via notify callback to [graph] channel |
| OBS-02 | 29 | UserView renders lifecycle events with color coding |
| OBS-04 | 29 | _get_rss_bytes(), rss_delta_bytes field |
| OBS-06 | 29 | OutputPolicy enum with should_emit() |
| INT-01 | 26 | TaskManager integration, Ctrl-C menu |
| INT-02 | 29 | ChannelRouter -> SessionStore pipeline |
| INT-03 | 29 | Stress test: 15 concurrent graphs passing |
| MODE-02 | 27 | graph() factory with _graph_ctx auto-registration (partial) |
| MODE-06 | 28 | @g routing from PY/BASH modes (partial) |
| GATE-03 | 28 | @g routing survives, GRAPH input command gone (partial) |

### Removed by Quick Task 1 (7/25)

These were implemented, verified, then deliberately removed when GRAPH mode was deleted. All underlying engine APIs survive — only the command interface layer was deleted.

| Requirement | Description | Infrastructure Status |
|---|---|---|
| MODE-01 | GRAPH mode command parser | Deleted (graph_commands.py) |
| MODE-03 | list command | Deleted; engine.active() API exists |
| MODE-04 | cancel \<id\> command | Deleted; Ctrl-C menu works |
| MODE-05 | inspect \<id\> command | Deleted; engine.get() API exists |
| GATE-05 | Shush toggle | Deleted with GRAPH mode |
| OBS-03 | Debug view with timings | Deleted; data accessible via Python |
| OBS-05 | asyncio.capture_call_graph | Deleted; API available in Python |

## Cross-Phase Integration

**Status:** All connections verified (42 wiring points)

| From | To | Via | Status |
|---|---|---|---|
| Phase 26 (Engine) | Phase 28 (Gates) | GATE_HOOK_KEY in dep_cache | Connected |
| Phase 28 (Gates) | Shell (@g routing) | _resolve_gate_input | Connected |
| Phase 26 (Engine) | Phase 29 (Observability) | DEP_TIMING_KEY, OutputPolicy, _lifecycle | Connected |
| Phase 27 (graph factory) | Phase 26 (Engine) | _graph_ctx contextvar auto-registration | Connected |
| Phase 29 (Observability) | Views | metadata type=lifecycle rendering | Connected |
| Phase 30 (Agent Core) | REPL | Zero REPL imports in agent.py | Decoupled |

### Orphaned APIs (2)

- `GraphRegistry.active()` — no callers after GRAPH mode removal
- `GraphRegistry.get()` — no callers after GRAPH mode removal

## E2E Flows

### Flow 1: Programmatic Graph with Gate (SURVIVES)

PY mode `await mygraph(msg="hi")` -> graph() wrapper -> _graph_ctx -> engine.submit_coro() -> resolver hits Gate field -> GATE_HOOK_KEY -> InputGate created -> toolbar badge updates -> user types `@g1.0 yes` -> _resolve_gate_input -> TypeAdapter validates -> engine.resolve_gate() -> Future set -> graph resumes -> lifecycle events to [graph] channel

### Flow 2: Direct API (No Engine)

`result = await Graph(start=MyNode).arun(msg="hi")` -> direct execution, no engine, no REPL

## Quick Task Impact

### Quick Task 1: Remove GRAPH Mode

Deliberately removed GRAPH mode command interface. 7 requirements affected. All underlying engine APIs (submit, active, get, gates, timing, observability) survive intact. The capability gap is in user-facing commands only — everything is still accessible from PY mode via Python API.

### Quick Task 2: Codebase Refactor

Executed all 8 audit priorities from codebase-cleanup.md. Zero regressions (647 tests passing). Consolidation of duplicated logic, factory-generated gates, decomposed long functions, shared lifecycle context manager. No functional changes.

## Tech Debt

### From GRAPH Mode Removal

- 7 requirements no longer satisfied in codebase (infrastructure survives)
- 2 orphaned engine API methods (active, get)
- No interactive graph management without PY mode Python
- No shush/debug commands

### From Phase 30

- AgenticBackend removed post-verification; Phase 30 VERIFICATION.md stale
- extract_executable extraction to bae/agent.py remains intact

### Pre-existing

- tests/traces/json_structured_fill_reference.py drifted from real backend
- AI streaming/progressive display deferred
- work/models.py: RoadmapData.phases is list[dict], ProjectState.status is bare str
- work/deps.py: scan_secrets() and detect_brownfield() are stubs

## Test Suite

**647 passed, 5 skipped** (post quick task 2 refactor)

---

*Audited: 2026-02-16T02:30:00Z*
*Auditor: Claude (milestone-audit orchestrator + integration checker)*
*Revision: Accounts for quick task 1 (GRAPH mode removal) and quick task 2 (codebase refactor)*
